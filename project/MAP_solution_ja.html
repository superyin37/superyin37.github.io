<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kaggle MAP | æ®· æ™—é™½</title>
  <link rel="stylesheet" href="../style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Noto+Sans+JP:wght@400;600&display=swap" rel="stylesheet">
  <style>
    .lang { display:none; }
    .lang.active { display:block; }
    #lang-toggle {
      background:#FFB800; border:none; padding:0.4rem 0.8rem;
      border-radius:4px; cursor:pointer; font-weight:600;
      position:fixed; top:1rem; right:1rem; z-index:200;
    }
    pre, code { background:#f6f6f6; padding:0.4rem; border-radius:4px; display:block; overflow-x:auto;}
    table {border-collapse:collapse; width:100%; margin:1rem 0;}
    th,td {border:1px solid #ddd; padding:0.5rem; text-align:left;}
    th {background:#f0f0f0;}
  </style>
</head>
<body>

  <button id="lang-toggle">English</button>

  <!-- ===== Japanese Version ===== -->
  <div id="lang-jp" class="lang active">

    <nav>
      <div class="logo"><a href="../index.html" style="color:white;text-decoration:none;">â† Back to Home</a></div>
    </nav>

    <section class="hero">
      <h1>Charting Student Math Misunderstandings (MAP)</h1>
      <p>ğŸ¥ˆ éŠ€ãƒ¡ãƒ€ãƒ«ï¼ˆä¸Šä½5%ï¼‰</p>
      <p>Public LB: 0.945â€ƒâ€ƒPrivate LB: 0.946</p>
      <p><a href="https://www.kaggle.com/competitions/map-charting-student-math-misunderstandings" target="_blank">[ã‚³ãƒ³ãƒšãƒšãƒ¼ã‚¸]</a></p>
    </section>

    <section>
      <h2>ä¸€ã€ã‚¿ã‚¹ã‚¯æ¦‚è¦</h2>
      <p>æœ¬ã‚³ãƒ³ãƒšã®ç›®çš„ã¯ã€å­¦ç”ŸãŒæ•°å­¦ã®é¸æŠå¼å•é¡Œã«å›ç­”ã™ã‚‹éš›ã«ç¤ºã™
      <strong>èª¤ç­”ã‚¿ã‚¤ãƒ—ï¼ˆCategory:Misconceptionï¼‰</strong>ã‚’äºˆæ¸¬ã™ã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚</p>
      <ul>
        <li>å•é¡Œæ–‡ï¼ˆQuestionTextï¼‰</li>
        <li>å­¦ç”ŸãŒé¸æŠã—ãŸè§£ç­”ï¼ˆMC_Answerï¼‰</li>
        <li>å­¦ç”Ÿã«ã‚ˆã‚‹èª¬æ˜æ–‡ï¼ˆStudentExplanationï¼‰</li>
      </ul>
      <p>å‡ºåŠ›ã¯65ç¨®é¡ã®ã€ŒCategory:Misconceptionã€ãƒ©ãƒ™ãƒ«ã®ã„ãšã‚Œã‹ã€‚</p>
      <ul>
        <li>ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã«å«ã¾ã‚Œãªã„ãƒ«ãƒ¼ãƒ«ï¼ˆunseen rulesï¼‰ã®å­˜åœ¨</li>
        <li>å­¦ç”Ÿèª¬æ˜æ–‡ã®è¡¨ç¾ãŒå¤šæ§˜ã§æ„å‘³ã®å·®ç•°ãŒå¤§ãã„</li>
        <li>ãƒ©ãƒ™ãƒ«åˆ†å¸ƒãŒä¸å‡è¡¡</li>
      </ul>
    </section>

    <section>
      <h2>äºŒã€å…¨ä½“çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h2>
      <p><strong>è¤‡æ•°LLMã®LoRAå¾®èª¿æ•´ï¼‹åŠ é‡ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«</strong>æˆ¦ç•¥ã‚’æ¡ç”¨ã€‚
      4ã¤ã®æŒ‡ç¤ºå¾®èª¿æ•´ãƒ¢ãƒ‡ãƒ«ã‚’çµ„ã¿åˆã‚ã›ã€è¨€èªãƒ»è«–ç†ãƒ»æ•°å­¦çš„è£œå®Œæ€§ã‚’æ´»ç”¨ã—ãŸã€‚</p>
      <table>
        <tr><th>ãƒ¢ãƒ‡ãƒ«</th><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¦æ¨¡</th><th>å­¦ç¿’æ–¹å¼</th><th>ç‰¹å¾´</th></tr>
        <tr><td>Gemma2-9B-IT</td><td>9B</td><td>LoRA-CV945</td><td>è‹±èªç†è§£ã¨æ„å‘³çš„ãƒ­ãƒã‚¹ãƒˆæ€§</td></tr>
        <tr><td>Qwen3-8B</td><td>8B</td><td>LoRA-MAP</td><td>å¤šè¨€èªé©å¿œæ€§</td></tr>
        <tr><td>DeepSeek-Math-7B</td><td>7B</td><td>LoRA-MAP</td><td>æ•°å­¦çš„æ¨è«–åŠ›</td></tr>
        <tr><td>Hunyuan-7B-Instruct</td><td>7B</td><td>LoRA-MAP</td><td>æŒ‡ç¤ºä¸€èˆ¬åŒ–ã¨å®‰å®šæ€§</td></tr>
      </table>
    </section>

    <section>
      <h2>ä¸‰ã€ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†</h2>
      <h3>ãƒ©ãƒ™ãƒ«æ§‹ç¯‰</h3>
<pre><code>train["target"] = train["Category"] + ":" + train["Misconception"]
train["label"] = LabelEncoder().fit_transform(train["target"])
</code></pre>
      <h3>æ­£ç­”ç‰¹å¾´æŠ½å‡º</h3>
<pre><code>idx = train.apply(lambda row: row.Category.split("_")[0], axis=1) == "True"
correct = train.loc[idx].groupby(["QuestionId","MC_Answer"]).head(1)
</code></pre>
      <h3>å…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
<pre><code>Question: {QuestionText}
Answer: {MC_Answer}
Correct? {Yes/No}
Student Explanation: {StudentExplanation}
</code></pre>
    </section>

    <section>
      <h2>å››ã€ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆLoRAï¼‰</h2>
      <table>
        <tr><th>ãƒ¢ãƒ‡ãƒ«</th><th>Rank</th><th>LR</th><th>Batch</th><th>CV</th><th>èª¬æ˜</th></tr>
        <tr><td>Gemma2-9B-IT</td><td>16</td><td>2e-4</td><td>8</td><td>0.945</td><td>ãƒ¡ã‚¤ãƒ³</td></tr>
        <tr><td>Qwen3-8B</td><td>16</td><td>2e-4</td><td>8</td><td>0.944</td><td>æ„å‘³çš„åºƒã•</td></tr>
        <tr><td>DeepSeek-Math-7B</td><td>16</td><td>2e-4</td><td>8</td><td>0.944</td><td>æ•°å­¦çš„è«–ç†æ€§</td></tr>
        <tr><td>Hunyuan-7B</td><td>16</td><td>2e-4</td><td>8</td><td>0.943</td><td>å®‰å®šæ€§</td></tr>
      </table>
    </section>

    <section>
      <h2>äº”ã€æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹</h2>
      <ul>
        <li>Gemma2-9Bï¼šå˜GPUæ¨è«–ã€Top-25ç¢ºç‡å‡ºåŠ›</li>
        <li>Qwen3 + DeepSeekï¼šãƒãƒ«ãƒGPUä¸¦åˆ—æ¨è«–ï¼ˆç´„100ç§’ï¼‰</li>
        <li>Hunyuanï¼šå˜GPUã§åŒæ§˜æ‰‹é †</li>
      </ul>
<pre><code>row_id, top_classes, prob_0, prob_1, ..., prob_24
</code></pre>
    </section>

    <section>
      <h2>å…­ã€ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æˆ¦ç•¥</h2>
<pre><code>final_score = 0.6 * weighted_mean_prob \
             + 0.3 * agreement_bonus \
             + 0.1 * confidence_bonus
</code></pre>
      <p>4ãƒ¢ãƒ‡ãƒ«å‡ºåŠ›ã‚’çµ±åˆã—ã€Top-3ã‚’æœ€çµ‚äºˆæ¸¬ã€‚</p>
    </section>

    <section>
      <h2>ä¸ƒã€çµæœæ¦‚è¦</h2>
      <table>
        <tr><th>ãƒ¢ãƒ‡ãƒ«</th><th>CV</th><th>Public</th><th>Private</th></tr>
        <tr><td>DeepSeek-7B</td><td>0.944</td><td>0.942</td><td>0.942</td></tr>
        <tr><td>Qwen3-8B</td><td>0.945</td><td>0.944</td><td>0.945</td></tr>
        <tr><td>Gemma2-9B</td><td>0.942</td><td>0.943</td><td>0.944</td></tr>
        <tr><td>Hunyuan-7B</td><td>0.943</td><td>0.943</td><td>0.943</td></tr>
        <tr><td><strong>ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«</strong></td><td><strong>0.948</strong></td><td><strong>0.945</strong></td><td><strong>0.946 ğŸ¥ˆ</strong></td></tr>
      </table>
    </section>

    <section>
      <h2>å…«ã€ç’°å¢ƒ</h2>
      <ul>
        <li>Transformers 4.56.1 / PEFT 0.11.1 / Torch 2.3</li>
        <li>Kaggle T4Ã—2 GPU</li>
        <li>FP16 / BF16</li>
        <li>ç·å®Ÿè¡Œæ™‚é–“ï¼šç´„3åˆ†</li>
      </ul>
    </section>

    <section>
      <h2>ä¹ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ</h2>
<pre><code>â”œâ”€â”€ gemma2_inference.py
â”œâ”€â”€ qwen3_deepseek_inference.py
â”œâ”€â”€ hunyuan_inference.py
â”œâ”€â”€ ensemble.py
â””â”€â”€ submission.csv
</code></pre>
    </section>

  </div>


  <!-- ===== English Version ===== -->
  <div id="lang-en" class="lang">

    <nav>
      <div class="logo"><a href="../index.html" style="color:white;text-decoration:none;">â† Back to Home</a></div>
    </nav>

    <section class="hero">
      <h1>Charting Student Math Misunderstandings (MAP)</h1>
      <p>ğŸ¥ˆ Silver Medal (~Top 5%)  Rank 53 / 1858</p>
      <p>Public LB 0.945â€ƒPrivate LB 0.946</p>
      <p><a href="https://www.kaggle.com/competitions/map-charting-student-math-misunderstandings" target="_blank">[Competition Page]</a></p>
    </section>

    <section>
      <h2>1. Problem Overview</h2>
      <p>
        Multi-class classification: predict the most likely <em>Category:Misconception</em> label (65 classes) from a math question,
        the studentâ€™s chosen answer, and written explanation.
      </p>
      <ul>
        <li>Unseen rules â†’ domain generalization</li>
        <li>Subtle semantic variations in explanations</li>
        <li>Severe label imbalance</li>
      </ul>
    </section>

    <section>
      <h2>2. Overall Approach</h2>
      <p>Adopted a <strong>multi-LLM LoRA fine-tuning + weighted ensemble</strong> strategy.</p>
      <table>
        <tr><th>Model</th><th>Size</th><th>Fine-tune</th><th>Role</th></tr>
        <tr><td>Gemma2-9B-IT</td><td>9B</td><td>LoRA-CV945</td><td>Main baseline</td></tr>
        <tr><td>Qwen3-8B</td><td>8B</td><td>LoRA-MAP</td><td>Semantic coverage</td></tr>
        <tr><td>DeepSeek-Math-7B</td><td>7B</td><td>LoRA-MAP</td><td>Math logic understanding</td></tr>
        <tr><td>Hunyuan-7B</td><td>7B</td><td>LoRA-MAP</td><td>Stable reasoning generalization</td></tr>
      </table>
    </section>

    <section>
      <h2>3. Data Processing</h2>
<pre><code>train["target"] = train["Category"] + ":" + train["Misconception"]
train["label"] = LabelEncoder().fit_transform(train["target"])
</code></pre>
<pre><code>idx = train.apply(lambda r: r.Category.split("_")[0], axis=1) == "True"
correct = train.loc[idx].groupby(["QuestionId","MC_Answer"]).head(1)
</code></pre>
<pre><code>Question: {QuestionText}
Answer: {MC_Answer}
Correct? {Yes/No}
Student Explanation: {StudentExplanation}
</code></pre>
    </section>

    <section>
      <h2>4. Model Fine-Tuning</h2>
      <table>
        <tr><th>Model</th><th>Rank</th><th>LR</th><th>Batch</th><th>CV</th></tr>
        <tr><td>Gemma2-9B-IT</td><td>16</td><td>2e-4</td><td>8</td><td>0.945</td></tr>
        <tr><td>Qwen3-8B</td><td>16</td><td>2e-4</td><td>8</td><td>0.944</td></tr>
        <tr><td>DeepSeek-Math-7B</td><td>16</td><td>2e-4</td><td>8</td><td>0.944</td></tr>
        <tr><td>Hunyuan-7B</td><td>16</td><td>2e-4</td><td>8</td><td>0.943</td></tr>
      </table>
    </section>

    <section>
      <h2>5. Inference Pipeline</h2>
      <ul>
        <li>Gemma2 single-GPU inference â†’ Top-25 probabilities</li>
        <li>Qwen3 + DeepSeek parallel on two GPUs (~100 s)</li>
        <li>Hunyuan same as Gemma2</li>
      </ul>
<pre><code>row_id, top_classes, prob_0, prob_1, ..., prob_24
</code></pre>
    </section>

    <section>
      <h2>6. Ensemble Strategy</h2>
<pre><code>final_score = 0.6 * weighted_mean_prob \
             + 0.3 * agreement_bonus \
             + 0.1 * confidence_bonus
</code></pre>
      <p>Combine four models and rank Top-3 predictions.</p>
    </section>

    <section>
      <h2>7. Results Summary</h2>
      <table>
        <tr><th>Model</th><th>CV</th><th>Public</th><th>Private</th></tr>
        <tr><td>DeepSeek-Math-7B</td><td>0.944</td><td>0.942</td><td>0.942</td></tr>
        <tr><td>Qwen3-8B</td><td>0.945</td><td>0.944</td><td>0.945</td></tr>
        <tr><td>Gemma2-9B</td><td>0.942</td><td>0.943</td><td>0.944</td></tr>
        <tr><td>Hunyuan-7B</td><td>0.943</td><td>0.943</td><td>0.943</td></tr>
        <tr><td><strong>Ensemble (final)</strong></td><td><strong>0.948</strong></td><td><strong>0.945</strong></td><td><strong>0.946 ğŸ¥ˆ</strong></td></tr>
      </table>
    </section>

    <section>
      <h2>8. Environment & Reproducibility</h2>
      <ul>
        <li>transformers 4.56.1 / peft 0.11.1 / torch 2.3</li>
        <li>Kaggle T4Ã—2 GPUs</li>
        <li>FP16 / bfloat16 precision</li>
        <li>Total runtime â‰ˆ 3 min</li>
      </ul>
    </section>

    <section>
      <h2>9. Repository Structure</h2>
<pre><code>â”œâ”€â”€ gemma2_inference.py
â”œâ”€â”€ qwen3_deepseek_inference.py
â”œâ”€â”€ hunyuan_inference.py
â”œâ”€â”€ ensemble.py
â””â”€â”€ submission.csv
</code></pre>
    </section>

  </div>

  <footer>
    <p>Â© 2025 Yin Hanyang</p>
  </footer>

  <script>
    const btn = document.getElementById("lang-toggle");
    const jp = document.getElementById("lang-jp");
    const en = document.getElementById("lang-en");
    let isEN = false;
    btn.addEventListener("click", ()=>{
      isEN = !isEN;
      if(isEN){
        jp.classList.remove("active");
        en.classList.add("active");
        btn.textContent = "æ—¥æœ¬èª";
      } else {
        en.classList.remove("active");
        jp.classList.add("active");
        btn.textContent = "English";
      }
    });
  </script>

</body>
</html>
